{% extends 'base.html' %}
{% block content %}
<h1>Tracks in this contest</h1>
{% for track in tracks %}
{# Split username in _id and name #}
{% set current_user = track.user.split(',') %}

<div class="row">
    <div class="col s12">
        <ul class="collapsible">
            <li>
                <div>
                    <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay"
                        src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/{{track.soundcloud}}&color=%23080606&visual=false&&auto_play=false&hide_related=true&show_comments=flase&show_user=true&show_reposts=false&show_teaser=false&show_playcount=false&liking=fals‌​e&sharing=false&download=false&following=false&buying=false"></iframe>
                </div>
            </li>
            <li>
                <div class="collapsible-header">
                    <i class="material-icons">info</i>{{track.artist_name}} - {{track.title}}
                </div>
                <div class="collapsible-body">
                    <div class="row">
                        <div class="col s12 m6">
                            <p>
                                {{ track.artist_name }}: {{track.free_text}}
                            </p>
                        </div>
                        <div class="col s12 m6">
                            <p>
                                {{ track.title }} is a {{ track.style.lower() }} track made by {{ track.artist_name }}.
                                It was created in {{ track.creation_date }} and was made using
                                {{ track.creation_method.lower() }}. Credits go to {{ track.credits_who }} for
                                {{ track.credits_what }}. This work is
                                licensed under
                                {{ track.license }}.<br>
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <p class="er-center">This track was submitted by <a
                                    href="{{url_for('view_user', user_id=current_user[0])}}" name="View user details">
                                    {{ current_user[1] }} </a> </p>
                        </div>
                    </div>
                </div>

            </li>
            <li>
                <div class="collapsible-header">
                    <i class="material-icons">info</i>Votes
                    <span class="er-right">Total score: {{track.total_votes}}</span>
                </div>
                <div class="collapsible-body">
                    <div class="row">
                        {% for vote in track.votes %}
                        {% if vote.voted_user %}
                        {# Split voted username in _id and name #}
                        {% set current_voter = vote.voted_user.split(',') %}

                        <div class="col s2">
                            <a href="{{url_for('view_user', user_id=current_user[0])}}" name="View user details">
                                {{ current_voter[1] }} </a>
                        </div>
                        <div class="col s2">
                            {{ vote.vote }}
                        </div>
                        <div class="col s8">
                            {{ vote.motivation }}
                        </div>

                        {% endif %}
                        {% endfor %}
                    </div>
                    <a href="{{url_for('vote_track', track_id=track._id)}}"
                        class="waves-effect waves-light btn btn_small grey">Vote for this track</a>
                </div>
            </li>
        </ul>
    </div>
</div>

{% endfor %}
{% endblock %}